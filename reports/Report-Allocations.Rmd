---
title: "Allocations"
author: "Matthew Kuperus Heun"
date: '`r parsedate::format_iso_8601(Sys.time())`'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(ggplot2)
library(knitr)
library(magrittr)
library(MKHthemes)
library(parsedate)
library(rprojroot)
library(SEAPSUTWorkflow)

# Set up the root directory
root <- rprojroot::is_rstudio_project
# And the cache
cache_path <- root$find_file(".drake")
```

## Introduction

Put an introduction here.


## Residential electricity

This is a sample graph showing the world allocation of residential electricity over time.

```{r, echo = FALSE}
residential_elect <- function(.df) {
  .df %>%     
    ggplot2::ggplot(mapping = ggplot2::aes(x = .data[[IEATools::iea_cols$year]], 
                                           y = .data[[IEATools::template_cols$.values]], 
                                           fill = .data[[IEATools::template_cols$machine]])) + 
    ggplot2::geom_area() + 
    
    ggplot2::facet_grid(rows = ggplot2::vars(.data[[IEATools::iea_cols$country]]),
                        cols = ggplot2::vars(.data[[IEATools::template_cols$destination]])) +
    
    theme(axis.title.x = element_blank(),
          legend.title = element_blank())
}

drake::readd(SEAPSUTWorkflow::target_names$CompletedAllocationTables, path = cache_path, character_only = TRUE) %>%
  dplyr::group_by(.data[[IEATools::iea_cols$country]]) %>% 
  
    dplyr::filter(.data[[IEATools::template_cols$ef_product]] == "Electricity",
                  .data[[IEATools::template_cols$destination]] == "Residential") %>%

  residential_elect() + 
  
  MKHthemes::xy_theme()

```